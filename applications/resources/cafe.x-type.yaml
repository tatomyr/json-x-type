openapi: 3.2.0
info:
  title: Redocly Cafe
  description: |
    REST API for managing cafe operations.
  version: 1.0.0
  contact:
    email: team@redocly.com
    url: https://redocly.com/contact-us/
  license:
    name: MIT
    url: https://opensource.org/licenses/MIT
  termsOfService: https://redocly.com/subscription-agreement
servers:
  - url: https://cafe.redocly.com/v1
    description: Live server.
tags:
  - name: Products
    description: Operations related to products.
  - name: Orders
    description: Order management operations.
  - name: Auth
    description: Authentication operations.
  - name: Stats
    description: Statistics operations.
paths:
  /menu:
    get:
      tags:
        - Products
      summary: List menu items
      description: Retrieve a collection of menu items with optional filtering and pagination.
      operationId: listMenuItems
      security: []
      parameters:
        - $ref: '#/components/parameters/After'
        - $ref: '#/components/parameters/Before'
        - $ref: '#/components/parameters/Sort'
        - $ref: '#/components/parameters/Filter'
        - $ref: '#/components/parameters/Search'
        - $ref: '#/components/parameters/Limit'
      responses:
        '200':
          description: Successful operation.
          content:
            application/json:
              x-type:
                $ref: '#/components/x-types/MenuItemList'
        '400':
          $ref: '#/components/responses/BadRequest'
        '500':
          $ref: '#/components/responses/InternalServerError'
    post:
      tags:
        - Products
      summary: Create menu item
      description: Create a new menu item.
      operationId: createMenuItem
      security:
        - OAuth2:
            - menu:write
      requestBody:
        required: true
        content:
          multipart/form-data:
            x-type:
              $ref: '#/components/x-types/MenuItem'
              $omit:
                - createdAt
                - updatedAt
                - id
                - object
      responses:
        '201':
          description: Menu item created successfully.
          content:
            application/json:
              x-type:
                $ref: '#/components/x-types/MenuItem'
                $omit:
                  - photo
                  - photoTextDescription
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '409':
          $ref: '#/components/responses/Conflict'
        '500':
          $ref: '#/components/responses/InternalServerError'
  /menu/{menuItemId}:
    parameters:
      - $ref: '#/components/parameters/MenuItemId'
    delete:
      tags:
        - Products
      summary: Delete menu item
      description: Delete an existing menu item.
      operationId: deleteMenuItem
      security:
        - OAuth2:
            - menu:write
      responses:
        '204':
          description: Menu item deleted successfully.
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'
  /menu-item-images/{menuItemId}:
    parameters:
      - $ref: '#/components/parameters/MenuItemId'
    get:
      operationId: getMenuItemPhoto
      summary: Get menu item photo
      description: Retrieve the product photo image for a specific menu item.
      security: []
      tags:
        - Products
      parameters:
        - $ref: '#/components/parameters/PhotoSize'
      responses:
        '200':
          description: Menu item photo retrieved successfully.
          content:
            image/png:
              x-type: string::binary
            text/plain:
              x-type: string
        '404':
          $ref: '#/components/responses/NotFound'
  /orders:
    get:
      tags:
        - Orders
      summary: List orders
      description: Retrieve a collection of orders with optional filtering and pagination.
      operationId: listOrders
      security:
        - OAuth2:
            - orders:read
      parameters:
        - $ref: '#/components/parameters/Filter'
        - $ref: '#/components/parameters/Sort'
        - $ref: '#/components/parameters/Limit'
        - $ref: '#/components/parameters/After'
        - $ref: '#/components/parameters/Before'
        - $ref: '#/components/parameters/Search'
      responses:
        '200':
          description: Successful operation.
          content:
            application/json:
              x-type:
                $ref: '#/components/x-types/OrderList'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '500':
          $ref: '#/components/responses/InternalServerError'
    post:
      tags:
        - Orders
      summary: Create order
      description: |
        Create a new order.
        Order items cannot be changed - if they need to be updated, the order should be canceled and a new one placed.
        Orders cannot be deleted, only canceled.
      operationId: createOrder
      security:
        - OAuth2:
            - orders:write
      requestBody:
        required: true
        content:
          application/json:
            x-type:
              $ref: '#/components/x-types/Order'
              $omit:
                - id
                - object
                - status
                - totalPrice
                - createdAt
                - updatedAt
      responses:
        '201':
          description: Order placed successfully.
          content:
            application/json:
              x-type:
                $ref: '#/components/x-types/Order'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '500':
          $ref: '#/components/responses/InternalServerError'
  /orders/{orderId}:
    get:
      tags:
        - Orders
      summary: Get order by ID
      description: Retrieve a single order by its ID.
      operationId: getOrderById
      security: []
      parameters:
        - $ref: '#/components/parameters/OrderId'
      responses:
        '200':
          description: Successful operation.
          content:
            application/json:
              x-type:
                $ref: '#/components/x-types/Order'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'
    patch:
      tags:
        - Orders
      summary: Update order
      description: |
        Update an existing order status.
        Order items cannot be changed - if they need to be updated, the order should be canceled and a new one placed.
      operationId: updateOrder
      security:
        - OAuth2:
            - orders:write
      parameters:
        - $ref: '#/components/parameters/OrderId'
      requestBody:
        content:
          application/json:
            x-type:
              status:
                $ref: '#/components/x-types/OrderStatus'
      responses:
        '200':
          description: Order updated successfully.
          content:
            application/json:
              x-type:
                $ref: '#/components/x-types/Order'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'
    delete:
      tags:
        - Orders
      summary: Cancel order
      description: |
        Cancel the order.
        Orders cannot be deleted, only canceled.
      operationId: cancelOrder
      security:
        - OAuth2:
            - orders:write
      parameters:
        - $ref: '#/components/parameters/OrderId'
      responses:
        '204':
          description: Order status updated successfully.
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'
  /order-items:
    get:
      tags:
        - Orders
      summary: List order items
      description: |
        Returns an array of order items for a specific order.
        Use the `filter` parameter to filter by order ID.
      operationId: listOrderItems
      security:
        - OAuth2:
            - orders:read
      parameters:
        - name: filter
          description: Filters the collection items. This field requires a special format.
          in: query
          required: true
          example: orderId:ord_01h1s5z6vf2mm1mz3hevnn9va7
          x-type: string
      responses:
        '200':
          description: Successful operation.
          content:
            application/json:
              x-type:
                $array:
                  $ref: '#/components/x-types/OrderItem'
                  $omit:
                    - menuItemId
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'
  /revenue:
    get:
      tags:
        - Stats
      summary: Get revenue statistics
      description: |
        Retrieve revenue statistics for a configurable date range.
        Returns revenue, order counts, average order amount, and other useful statistics.
      operationId: getRevenue
      security:
        - ApiKey: []
      parameters:
        - name: startDate
          in: query
          required: false
          description: Start date for the revenue calculation period (ISO 8601 datetime format). Defaults to 30 days ago if not provided.
          example: '2024-01-01'
          x-type: string::date
        - name: endDate
          in: query
          required: false
          description: End date for the revenue calculation period (ISO 8601 datetime format). Defaults to current time if not provided.
          example: '2024-01-31'
          x-type: string::date
      responses:
        '200':
          description: Revenue statistics retrieved successfully.
          content:
            application/json:
              x-type:
                $ref: '#/components/x-types/RevenueStatistics'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '500':
          $ref: '#/components/responses/InternalServerError'
  /oauth2/register:
    post:
      tags:
        - Auth
      summary: Create OAuth2 client
      description: |
        Register a new OAuth2 client for dynamic client registration. 
        This endpoint implements the Dynamic Client Registration Protocol (RFC 7591), 
        using camelCase field names instead of the RFC's snake_case convention 
        (e.g., `redirectUris` instead of `redirect_uris`, `grantTypes` instead of `grant_types`).

        The `name` field is required. Other fields are optional. If not provided:
        - `redirectUris` defaults to an empty array. Note: When using the `authorization_code` grant type, 
          `redirectUris` must be provided (per RFC 7591 Section 2).
        - `scopes` defaults to all available scopes (menu:read, menu:write, orders:read, orders:write)
        - `grantTypes` defaults to both supported grant types (authorization_code, client_credentials)

        Returns the registered client information per RFC 7591, including:
        - `clientId` and `clientSecret` (must be stored securely)
        - `clientIdIssuedAt` and `clientSecretExpiresAt` timestamps
        - All registered client metadata (name, redirectUris, scopes, grantTypes)
      operationId: registerOAuth2Client
      security: []
      requestBody:
        required: true
        content:
          application/json:
            x-type:
              $ref: '#/components/x-types/RegisterClientObject'
      responses:
        '201':
          description: OAuth2 client registered successfully.
          content:
            application/json:
              x-type:
                $ref: '#/components/x-types/OAuth2Client'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '500':
          $ref: '#/components/responses/InternalServerError'
webhooks:
  order-notification:
    post:
      tags:
        - Orders
      operationId: orderNotificationWebhook
      security: []
      summary: Order notification webhook
      description: Webhook triggered when a new order is placed.
      requestBody:
        required: true
        content:
          application/json:
            x-type:
              $ref: '#/components/x-types/OrderNotification'
      responses:
        '200':
          description: Webhook received successfully.
        '400':
          $ref: '#/components/responses/BadRequest'
components:
  securitySchemes:
    OAuth2:
      type: oauth2
      description: OAuth2 authentication for API access.
      flows:
        authorizationCode:
          authorizationUrl: https://cafe.redocly.com/v1/oauth2/authorize
          tokenUrl: https://cafe.redocly.com/v1/oauth2/token
          scopes:
            menu:read: Read access to menu items and images
            menu:write: Write access to menu items (create, delete)
            orders:read: Read access to orders
            orders:write: Write access to orders (create, update, delete)
        clientCredentials:
          tokenUrl: https://cafe.redocly.com/v1/oauth2/token
          scopes:
            menu:read: Read access to menu items and images
            menu:write: Write access to menu items (create, delete)
            orders:read: Read access to orders
            orders:write: Write access to orders (create, update, delete)
    ApiKey:
      type: apiKey
      name: X-API-Key
      in: header
      description: API key for internal operations.
  parameters:
    After:
      name: after
      in: query
      required: false
      description: Use the `endCursor` as a value for the `after` parameter to get the next page.
      example: a25fgaksjf23la==
      x-type: string
    Before:
      name: before
      in: query
      required: false
      description: Use the `startCursor` as a value for the `before` parameter to get the next page.
      example: bfg23aksjf23zb1==
      x-type: string
    Sort:
      name: sort
      description: |-
        To sort by id in descending order use `-id`.
        To sort by id in ascending order use `id`.
      in: query
      required: false
      example: '-name'
      x-type: string
    Filter:
      name: filter
      description: Filters the collection items. This field requires a special format.
      in: query
      required: false
      example: orderId:ord_01h1s5z6vf2mm1mz3hevnn9va7
      x-type: string
    Search:
      name: search
      in: query
      description: Search.
      required: false
      example: text-to-search
      x-type: string
    Limit:
      name: limit
      description: |-
        Use to return a number of results per page.
        If there is more data, use in combination with `after` to page through the data.
      in: query
      required: false
      example: 10
      x-type: number::integer::min(1)::max(100)
    MenuItemId:
      name: menuItemId
      in: path
      description: ID of the menu item to retrieve.
      required: true
      example: prd_01h1s5z6vf2mm1mz3hevnn9va7
      x-type: string::pattern(^prd_[0-9abcdefghjkmnpqrstvwxyz]{26}$)
    PhotoSize:
      name: photoSize
      in: query
      description: Photo size to retrieve.
      required: false
      x-type:
        - thumbnail
        - medium
        - large
    OrderId:
      name: orderId
      in: path
      description: ID of the order to retrieve.
      required: true
      example: ord_01h1s5z6vf2mm1mz3hevnn9va7
      x-type: string::pattern(^ord_[0-9abcdefghjkmnpqrstvwxyz]{26}$)
  responses:
    BadRequest:
      description: Bad request - invalid input parameters.
      content:
        application/problem+json:
          x-type:
            $ref: '#/components/x-types/Error'
    InternalServerError:
      description: Internal server error.
      content:
        application/problem+json:
          x-type:
            $ref: '#/components/x-types/Error'
    Unauthorized:
      description: Unauthorized - authentication required.
      content:
        application/problem+json:
          x-type:
            $ref: '#/components/x-types/Error'
    Forbidden:
      description: Forbidden - insufficient permissions.
      content:
        application/problem+json:
          x-type:
            $ref: '#/components/x-types/Error'
    Conflict:
      description: Conflict - entity already exists.
      content:
        application/problem+json:
          x-type:
            $ref: '#/components/x-types/Error'
    NotFound:
      description: Resource not found.
      content:
        application/problem+json:
          x-type:
            $ref: '#/components/x-types/Error'
  x-types:
    Page:
      endCursor:
        - string
        - null
      startCursor:
        - string
        - null
      hasNextPage: boolean
      hasPrevPage: boolean
      limit: number::integer::min(1)::max(100)
      total: number::integer::min(0)
      $descriptions:
        endCursor: |-
          Use with the `after` query parameter to load the next page of data.
          When `null`, there is no data.
          The cursor is opaque and internal structure is subject to change.
        startCursor: |-
          Use with the `before` query parameter to load the previous page of data.
          When `null`, there is no data.
          The cursor is opaque and internal structure is subject to change.
        hasNextPage: Indicates if there is a next page with items.
        hasPrevPage: Indicates if there is a previous page with items.
        limit: Value showing how many items are in the page limit.
        total: Count of items across all pages.
    MenuItem:
      - $ref: '#/components/x-types/Beverage'
      - $ref: '#/components/x-types/Dessert'
    Base_MenuItem:
      createdAt: string::date-time
      updatedAt: string::date-time
      id: string::pattern(^prd_[0-9abcdefghjkmnpqrstvwxyz]{26}$)
      object: menuItem
      name: string::pattern(^[a-z]+(-[a-z]+)*$)::min(1)::max(50)
      price: number::integer::min(0)
      photo:
        - string::binary
        - null
        - undefined
      photoTextDescription:
        - string
        - null
        - undefined
      category:
        - beverage
        - dessert
      $descriptions:
        createdAt: Created date.
        updatedAt: Updated date.
        id: Menu item ID. Unique identifier prefixed with `prd_`.
        object: Entity name.
        name: Menu item name. Must be lowercase letters, optionally hyphenated.
        price: Price in cents.
        photo: Photo of the menu item. Must be a PNG image and less than 1MB.
        category: Menu item category.
    Beverage:
      $and:
        - $ref: '#/components/x-types/Base_MenuItem'
        - size: number::x-min(0)
          sizeType:
            - ml
            - oz
            - undefined
          containsCaffeine: boolean
          $descriptions:
            size: Size of the beverage.
            containsCaffeine: Indicates if the beverage contains caffeine.
        - category: beverage
    Dessert:
      $and:
        - $ref: '#/components/x-types/Base_MenuItem'
        - calories: number::x-min(0)
          $descriptions:
            calories: Amount of calories.
        - category: dessert
    MenuItemList:
      object: list
      page:
        $ref: '#/components/x-types/Page'
      items:
        $array:
          $ref: '#/components/x-types/MenuItem'
      $descriptions:
        object: Entity name.
    Error:
      type: string::uri-reference
      title: string
      status: number::int32::min(100)::x-max(600)
      instance:
        - string::uri-reference
        - undefined
      details:
        - $record: any
        - undefined
      $descriptions:
        type: URI reference that identifies the problem type.
        title: Short summary of the problem type.
        status: HTTP status code generated by the origin server for this occurrence of the problem.
        instance: |
          URI reference that identifies the specific occurrence of the problem, e.g. by adding a fragment identifier or sub-path to the problem type. May be used to locate the root of this problem in the source code.
        details: Additional error details.
    OrderStatus:
      - placed
      - preparing
      - completed
      - canceled
    Order:
      id:
        - string
        - undefined
      object:
        - order
        - undefined
      customerName: string::pattern(^[A-Za-z]+(?:[\s'-][A-Za-z]+)*$)::min(1)::max(100)
      status:
        - $ref: '#/components/x-types/OrderStatus'
        - undefined
      totalPrice:
        - number::integer::min(0)
        - undefined
      createdAt:
        - string::date-time
        - undefined
      updatedAt:
        - string::date-time
        - undefined
      orderItems:
        $array:
          menuItemId: string
          quantity: number::integer::min(1)
          discount:
            - number::integer::min(0)
            - undefined
          comment:
            - string::max(500)
            - undefined
          $descriptions:
            menuItemId: ID of the menu item to add to the order.
            quantity: Quantity of the menu item.
            discount: Discount amount in cents (absolute value).
            comment: Optional comment for the order item (e.g., "No sugar").
      $descriptions:
        id: Order ID. Unique identifier prefixed with `ord_`.
        object: Entity name.
        customerName: |
          Name of the customer who placed the order.
          Must start and end with a letter, and can contain letters, spaces, hyphens, and apostrophes (e.g., "John Doe", "Mary-Jane", "O'Brien").
        totalPrice: Total order price in cents.
        createdAt: Created date.
        updatedAt: Updated date.
        orderItems: List of items to include in the order.
    OrderList:
      object: list
      page:
        $ref: '#/components/x-types/Page'
      items:
        $array:
          $ref: '#/components/x-types/Order'
      $descriptions:
        object: Entity name.
    OrderItem:
      menuItemId: string
      menuItem:
        - $ref: '#/components/x-types/MenuItem'
        - undefined
      quantity: number::integer::min(1)
      discount:
        - number::integer::min(0)
        - undefined
      comment:
        - string::max(500)
        - undefined
      $descriptions:
        menuItemId: ID of the menu item to add to the order.
        menuItem: Menu item that is part of the order.
        quantity: Quantity of the menu item.
        discount: Discount amount in cents (absolute value).
        comment: Optional comment for the order item (e.g., "No sugar").
    RevenueStatistics:
      revenue: number::min(0)
      averageOrderAmount: number::min(0)
      totalOrders: number::integer::min(0)
      placedOrders: number::integer::min(0)
      preparingOrders: number::integer::min(0)
      completedOrders: number::integer::min(0)
      canceledOrders: number::integer::min(0)
      startDate: string::date
      endDate: string::date
      $descriptions:
        revenue: Total revenue in cents from completed orders.
        averageOrderAmount: Average order amount in cents (calculated from completed orders only).
        totalOrders: Total number of orders (all statuses) in the date range.
        placedOrders: Number of placed orders.
        preparingOrders: Number of preparing orders.
        completedOrders: Number of completed orders.
        canceledOrders: Number of canceled orders.
        startDate: Start date of the revenue calculation period.
        endDate: End date of the revenue calculation period.
    RegisterClientObject:
      name: string
      redirectUris:
        - $array: string::uri
        - undefined
      scopes:
        - $array:
            - menu:read
            - menu:write
            - orders:read
            - orders:write
        - undefined
      grantTypes:
        - $array:
            - authorization_code
            - client_credentials
        - undefined
      $descriptions:
        name: Client name.
        redirectUris: List of redirect URIs (optional, defaults to empty array).
        scopes: List of scopes.
        grantTypes: List of grant types.
    OAuth2Client:
      clientId: string
      clientSecret: string
      clientIdIssuedAt: number::int64
      clientSecretExpiresAt: number::int64
      name:
        - string
        - undefined
      redirectUris:
        - $array: string::uri
        - undefined
      registrationClientUri: string::uri
      registrationAccessToken: string
      scopes:
        - $array:
            - menu:read
            - menu:write
            - orders:read
            - orders:write
        - undefined
      grantTypes:
        - $array:
            - authorization_code
            - client_credentials
        - undefined
      $descriptions:
        clientId: Client identifier issued by the authorization server.
        clientSecret: Client secret issued by the authorization server.
        clientIdIssuedAt: Time when the client_id is issued, represented as seconds since epoch (RFC 7591).
        clientSecretExpiresAt: Time at which the client_secret expires, represented as seconds since epoch. 0 indicates the secret does not expire (RFC 7591).
        name: Client name (registered metadata).
        redirectUris: List of redirect URIs (registered metadata).
        registrationClientUri: URL of the client configuration endpoint for managing this client registration (RFC 7592).
        registrationAccessToken: Access token to be used at the client configuration endpoint for managing this client registration (RFC 7592).
        scopes: List of scopes (registered metadata).
        grantTypes: List of grant types (registered metadata).
    OrderNotification:
      orderId: string
      orderStatus:
        $ref: '#/components/x-types/OrderStatus'
      timestamp: string::date-time
      $descriptions:
        orderId: Unique order identifier.
        timestamp: When the event occurred.
